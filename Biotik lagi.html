<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petualangan Biotik & Abiotik</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.waves.min.js"></script>
	    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&family=Mochiy+Pop+One&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* background-color: #1a202c;  Removed to allow Vanta background to show */
        }
        #vanta-bg {
            width: 100%;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
        }
        .font-pixel {
            font-family: 'Press Start 2P', cursive;
        }
        .btn-3d {
            position: relative;
            border: 2px solid black;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            color: white;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 5px 0 black;
            transform: translateY(0);
        }
        .btn-3d:active {
            box-shadow: 0 2px 0 black;
            transform: translateY(3px);
        }
        .btn-3d:disabled {
            background-color: #4a5568;
            box-shadow: 0 5px 0 #1a202c;
            cursor: not-allowed;
        }
        .card { perspective: 1000px; }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .card.flipped .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 4px;
        }
        .card-front {
            background-color: #4a5568;
            font-size: 2.25rem;
        }
        .card-back {
            background-color: #2d3748;
            transform: rotateY(180deg);
            font-size: 1rem;
            font-weight: 600;
        }
        .draggable { cursor: grab; }
        .draggable:active { cursor: grabbing; }
        #game-canvas {
            background: url('https://www.transparenttextures.com/patterns/light-sketch.png');
            background-color: #e0f2fe;
            border-radius: 0.5rem;
            border: 2px solid #0c4a6e;
        }
        .map-location {
            position: absolute;
            text-align: center;
            transition: transform 0.3s;
            z-index: 1; /* Memastikan ikon di atas garis */
        }
        .map-location:hover {
            transform: scale(1.8);
        }
        .map-buttonHome {
            max-width: 40px;
            height: 100%;
			border-radius: 50%;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            overflow: hidden;
        }		
        .map-buttonHome:hover {
            transform: scale(2.8);
        }		
        .map-button {
            max-width: 160px;
            height: 100%;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            overflow: hidden;
        }
        .map-button:hover {
            transform: scale(1.8);
        }
        .map-button:disabled {
            filter: grayscale(100%);
            cursor: not-allowed;
        }
        .map-button img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .lock-icon {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #f59e0b; /* bg-amber-500 */
            border-radius: 9999px;
            padding: 6px;
            z-index: 10;
            border: 2px solid white;
        }
        .modal {
            background-color: rgba(0, 0, 0, 0.75);
            z-index: 50;
        }
		
        /* Developer Modal Styles */
        .modal-content {
            position: relative;
            background-color: #2d3748;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            max-width: 50%;
            width: 90%;
            overflow: hidden;
        }
        .modal-main-content {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            position: relative;
            z-index: 2;
        }
        .profile-pic-container {
            flex-shrink: 0;
            width: 100px;
            height: 200px;
            perspective: 1000px;
        }
        .profile-pic-container img {
            width: 100%;
            height: 100%;
            transition: transform 0.4s ease-out;
            object-fit: cover;
        }
        .modal-bg-image-profile {
            position: absolute;
            right: -20px;
            top: -20px;
            height: 120%;
            opacity: 0.15;
            pointer-events: none;
            z-index: 1;
            object-fit: cover;
            width: auto;
        }	
        .social-icons a {
            transition: color 0.3s;
        }
        .social-icons a:hover {
            color: #38bdf8; /* text-sky-400 */
        }
		
        .modal-scroll-content {
            overflow-y: auto; 
            max-height: 60vh; 
        }

       .map-bangbin {
            width: 120px; /* Adjusted size */
            height: auto;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .map-locationBangbin {
            position: absolute;
            text-align: center;
            transition: transform 0.3s;
            z-index: 2; /* Higher z-index */
            width: 160px;
        }
        .map-locationBangbin:hover {
            transform: scale(1.5);
        }
        .treasure-menu-buttons {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 2px;
        }
        .treasure-menu-buttons button {
            display: block;
            width: 100%;
            text-align: center;
            padding: 2px 0;
            font-weight: bold;
            color: #432818;
            font-family: 'Inter', sans-serif;
            background: none;
            border: none;
            font-size: 10px;
            cursor: pointer;
        }
         .treasure-menu-buttons button:hover {
            color: #fff; /* Darker brown on hover */
         }

        h5 {
            font-family: 'Mochiy Pop One', sans-serif;
            color: #014991;
            font-size: clamp(5.5rem, 7vw, 3.5rem);
            text-shadow: 2px 2px 0px white, 4px 4px 0px rgba(0,0,0,0.1);
        }

  h6 {
    font-family: 'Mochiy Pop One', sans-serif;
    color: #000000;
    font-size: clamp(5.5rem, 7vw, 6.5rem);
    text-shadow: 4px 4px 0px white, 8px 8px 0px rgba(0,0,0,0.1);
    z-index: 2;
    padding-left: 300px;
    margin-bottom: 2.5rem; /* Replaced mb-10 with exact value */
  }

  .btn-start3d {
    border: 2px solid black;
    border-radius: 0.5rem;
    color: white;
    font-weight: 600;
    transition: all 0.2s ease;
    box-shadow: 0 5px 0 black;
    transform: translateY(0);
    padding: 1rem 2rem; /* Replaced px-8 py-4 with standard values */
    font-size: 1.5rem; /* Replaced text-2xl with exact value */
    background-color: #22c55e; /* bg-green-500 */
    margin-left: 300px; /* Better than padding-left for buttons */
    width: fit-content; /* Ensures button doesn't stretch full width */
  }

  .btn-start3d:hover {
    background-color: #16a34a; /* hover:bg-green-600 */
  }

  .main-screen-char {
    position: absolute;
    bottom: 30px;
    max-height: 80%;
    max-width: 90%;
    height: auto;
    transition: transform 0.3s ease;
    pointer-events: none;
  }

  .char-left {
    left: 2px;
  }


    </style>
</head>
<body class="text-white overflow-hidden h-screen flex items-center justify-center p-4">
    
    <div id="vanta-bg"></div>

    <!-- Main Container -->
    <div id="app-container" class="w-full max-w-6xl mx-auto h-full">

        <!-- Start Screen -->
        <div id="start-screen" class="flex flex-col justify-center h-full text-left padding-left: 250px;">
            <h6 class="text-8xl md:text-8xl mb-10">Biotik Adventure</h6>
			<button id="start-adventure-btn" class="btn-start3d bg-green-500 hover:bg-green-600 text-2xl px-8 py-4 items-left" style=padding-left: 250px;>Mulai!</button>
			<img src="https://lh3.googleusercontent.com/d/1l76wnQNuqi_PfFKYk7MtDJnSicRzfXez" alt="Anak Laki-laki" style="max-width: 90%; height: auto;" class="main-screen-char char-left">
        </div>


        <!-- World Map Screen -->
        <div id="world-map-screen" class="flex flex-col items-center justify-center h-full">
            <div id="map-container" class="relative w-full max-w-9xl h-[80vh] bg-gray-1200/50 rounded-lg p-4 border-2 border-gray-600" style="background-image: url('data:image/svg+xml;utf8,%3Csvg%20width%3D%221920%22%20height%3D%221080%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%20%20%3Cdefs%3E%0A%20%20%20%20%3CradialGradient%20id%3D%22grad%22%20cx%3D%2250%25%22%20cy%3D%2250%25%22%20r%3D%2250%25%22%3E%0A%20%20%20%20%20%20%3Cstop%20offset%3D%220%25%22%20stop-color%3D%22%23a8d0ff%22%3E%3C%2Fstop%3E%0A%20%20%20%20%20%20%3Cstop%20offset%3D%22100%25%22%20stop-color%3D%22%23005f99%22%3E%3C%2Fstop%3E%0A%20%20%20%20%3C%2FradialGradient%3E%0A%20%20%3C%2Fdefs%3E%0A%0A%20%20%3Crect%20width%3D%221920%22%20height%3D%221080%22%20fill%3D%22url(%23grad)%22%3E%3C%2Frect%3E%0A%0A%20%20%3C!--%20Layer%20kontur%20air%20--%3E%0A%20%20%3Cpath%20d%3D%22M0%2C0%20C400%2C200%20800%2C0%201200%2C200%20S1800%2C0%201920%2C200%20V1080%20H0%20Z%22%20fill%3D%22%230077be%22%20opacity%3D%220.2%22%3E%3C%2Fpath%3E%0A%20%20%3Cpath%20d%3D%22M0%2C200%20C500%2C400%201000%2C100%201500%2C300%20S1920%2C100%201920%2C300%20V1080%20H0%20Z%22%20fill%3D%22%2366ccff%22%20opacity%3D%220.15%22%3E%3C%2Fpath%3E%0A%20%20%3Cpath%20d%3D%22M0%2C400%20C600%2C500%201200%2C300%201800%2C500%20S1920%2C300%201920%2C500%20V1080%20H0%20Z%22%20fill%3D%22%2399ddff%22%20opacity%3D%220.12%22%3E%3C%2Fpath%3E%0A%3C%2Fsvg%3E%0A'); background-size: cover; background-position: center;">
                <!-- Centered Title -->
                <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                    <h5 class="text-6xl md:text-6xl mb-2 text-center">Biotik Adventure</h1>
                    <p class="text-black text-center">Selesaikan level untuk membuka level berikutnya!</p>
                </div>
                
                <!-- Path SVG -->
                <svg class="absolute top-0 left-0 w-full h-full" viewBox="0 0 400 250" preserveAspectRatio="none">
                    <path d="M 80 155 Q 20 150 210 188 Q 260 190 360 130 Q 280 40 210 55" stroke-dasharray="8" class="stroke-yellow-300 opacity-75" stroke-width="3" fill="none" />
                </svg>
                
                <!-- Path SVG -->
                <svg class="absolute top-0 left-0 w-full h-full" viewBox="0 0 400 250" preserveAspectRatio="none">
                    <path d="M 80 155 Q 20 150 210 188 Q 260 190 360 130 Q 280 40 210 55" stroke-dasharray="8" class="stroke-yellow-300 opacity-75" stroke-width="3" fill="none" />
                </svg>

                <!-- Level Locations -->
                <div id="location-0" data-level="0" class="map-location" style="top: 45%; left: 10%;">
                    <button onclick="startGame(0)" class="map-button">
                        <img src="https://lh3.googleusercontent.com/d/1OJuf8EVuDWid5_6HJDnnLmprKXCbBRoH" alt="Hutan Ekologi" onerror="this.style.display='none'">
                    </button>
                </div>
                <div id="location-1" data-level="1" class="map-location" style="top: 60%; left: 45%;">
                    <button onclick="startGame(1)" class="map-button">
                        <img src="https://lh3.googleusercontent.com/d/1HNHD2_TrRkg1mQAgx_FTmgXLBxpDusT6" alt="Kuil Klasifikasi" onerror="this.style.display='none'">
                    </button>
                </div>
                <div id="location-2" data-level="2" class="map-location" style="top: 35%; left: 82%;">
                    <button onclick="startGame(2)" class="map-button">
                        <img src="https://lh3.googleusercontent.com/d/1DElNscdGgyrjjrJ5Nq9IfiQ6Av7VSZvp" alt="Gunung Ekosistem" onerror="this.style.display='none'">
                    </button>
                </div>
                <div id="location-3" data-level="3" class="map-location" style="top: 5%; left: 40%;">
                    <button onclick="startGame(3)" class="map-button">
                        <img src="https://lh3.googleusercontent.com/d/16RnKhLF7H0t3q5kRNvAhsizcZde0LLPH" alt="Lembah Komponen" onerror="this.style.display='none'">
                    </button>
                </div>
                <div class="map-locationBangbin" style="top: 5%; left: 15%;">
                    <img src="https://lh3.googleusercontent.com/d/1lcq5SvOWy8ahyulJeGZ7azQzP1u__fUc" alt="Menu Gulungan" class="w-full h-auto">
                    <div class="treasure-menu-buttons">
                        <button onclick="openModal('instructions-modal')">Petunjuk</button>
                        <button onclick="openModal('objectives-modal')">Tujuan</button>
                        <button onclick="openModal('material-modal')">Materi</button>
                        <button onclick="openModal('sumber-modal')">Credit</button>
                        <button onclick="openModal('developer-modal')">Profil</button>						
                    </div>
				</div>
                <div class="map-locationBangbin" style="top: 65%; left: 80%;">
                    <button onclick="resetProgress()" class="map-button">
                        <img src="https://lh3.googleusercontent.com/d/1_AF94SVJnc2b4jPzbJMH3aIlJ1UQgIQL" alt="Lembah Komponen">
                    </button>
                </div>
                <div class="map-locationBangbin" style="top: 85%; left: 3%;">
                    <a href="#" target="_blank"><button class="map-buttonHome">
					<img src="https://lh3.googleusercontent.com/d/17ImKU1TYw__lqoBvMVw4S0XDMNKgaG3g" alt="home">
                    </button></a>
                </div>

                <!-- Music Toggle Button -->
                <button id="music-toggle-btn" class="absolute btn-3d bg-black-600 hover:bg-black-700 text-lg p-2" style="top: 5%; left: 90%;">
				<i class="fa-solid fa-skull"></i></button>
				
            </div>

        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="hidden flex-col h-full">
            <div class="flex justify-between items-center mb-4">
                <button onclick="returnToMap()" class="btn-3d bg-gray-500 hover:bg-gray-600 text-sm px-4 py-2">← Peta</button>
                <h2 id="game-title" class="text-2xl md:text-3xl font-pixel text-yellow-400">Nama Game</h2>
                <div class="w-24"></div>
            </div>
            <div class="flex justify-around bg-gray-800/70 backdrop-blur-sm p-3 rounded-lg mb-4 text-center">
                <div><p class="text-lg font-bold text-cyan-400">ANDA</p><p id="player-score" class="text-3xl font-bold">0</p></div>
                <div id="timer-display" class="flex items-center"><p class="text-4xl font-bold text-white">VS</p></div>
                <div><p class="text-lg font-bold text-red-400">KOMPUTER</p><p id="computer-score" class="text-3xl font-bold">0</p></div>
            </div>
            <div id="game-container" class="flex-grow bg-gray-800/70 backdrop-blur-sm rounded-lg p-4 flex items-center justify-center relative"></div>
        </div>
    </div>

    <!-- Modals Container -->
    <div id="result-modal" class="hidden fixed inset-0 modal flex items-center justify-center">
        <div class="bg-gray-700/80 backdrop-blur-md p-8 rounded-lg text-center shadow-xl max-w-3xl w-full">
            <h3 id="result-message" class="text-4xl font-pixel mb-6">Kamu Menang!</h3>
            <p id="unlock-message" class="text-yellow-300 mb-6 hidden">Level baru telah terbuka!</p>
            <button onclick="closeModalAndReturn()" class="btn-3d bg-yellow-500 hover:bg-yellow-600 text-gray-900">Kembali ke Peta</button>
        </div>
    </div>

    <div id="instructions-modal" class="hidden fixed inset-0 modal flex items-center justify-center">
        <div class="bg-gray-700/80 backdrop-blur-md p-8 rounded-lg text-center shadow-xl max-w-5xl w-full">
            <h3 class="text-3xl font-pixel text-cyan-400 mb-6 text-center">Petunjuk Permainan</h3>
            <div class="text-left space-y-4">
                <p>Selamat datang di <strong>Petualangan Ekosistem!</strong> Tujuanmu adalah menyelesaikan 4 level permainan untuk mempelajari komponen biotik dan abiotik.</p>
                <ul class="list-disc list-inside space-y-2">
                    <li><strong>Sistem Level:</strong> Kamu harus memenangkan satu level untuk membuka level berikutnya.</li>
                    <li><strong>Level 1 - Hutan Ekologi:</strong> Jodohkan komponen biotik (makhluk hidup) dengan komponen abiotik (benda mati) yang berhubungan.</li>
                    <li><strong>Level 2 - Kuil Klasifikasi:</strong> Seret dan lepaskan setiap gambar ke dalam kotak kategori yang benar (Biotik atau Abiotik).</li>
                    <li><strong>Level 3 - Gunung Ekosistem:</strong> Jawab pertanyaan pilihan ganda seputar ekosistem lebih cepat dari komputer.</li>
                    <li><strong>Level 4 - Lembah Komponen:</strong> Tangkap hanya komponen yang diminta (biotik atau abiotik) sesuai petunjuk di layar.</li>
                </ul>
                <p>Kalahkan komputer di setiap level untuk membuktikan pemahamanmu. Selamat bermain dan belajar!</p>
            </div>
            <button onclick="closeModal('instructions-modal')" class="btn-3d bg-cyan-600 hover:bg-cyan-700 mt-6">Tutup</button>
        </div>
    </div>

    <div id="objectives-modal" class="hidden fixed inset-0 modal flex items-center justify-center">
        <div class="bg-gray-700/80 backdrop-blur-md p-8 rounded-lg shadow-xl max-w-5xl w-full">
            <h3 class="text-3xl font-pixel text-teal-400 mb-6 text-center">Tujuan Pembelajaran</h3>
            <ul class="text-left list-disc list-inside mb-6 space-y-2">
                <li>Membedakan antara komponen biotik dan abiotik.</li>
                <li>Mengklasifikasikan organisme dan benda tak hidup ke dalam kelompok yang benar.</li>
                <li>Memahami hubungan ketergantungan antara komponen biotik dan abiotik dalam suatu ekosistem.</li>
            </ul>
            <div class="text-center">
                <button onclick="closeModal('objectives-modal')" class="btn-3d bg-teal-600 hover:bg-teal-700">Tutup</button>
            </div>
        </div>
    </div>

    <div id="sumber-modal" class="hidden fixed inset-0 modal flex items-center justify-center">
        <div class="bg-gray-700/80 backdrop-blur-md p-8 rounded-lg shadow-xl max-w-2xl w-full">
            <h3 class="text-3xl font-pixel text-teal-400 mb-6 text-center">Sumber</h3>
                <ul class="list-disc list-inside space-y-2">
                    <li><strong>Sound Effect:</strong> www.myinstants.com</li>
                    <li><strong>Music Effect:</strong> www.myinstants.com</li>					
                    <li><strong>Icon:</strong> www.flaticon.com</li>
                    <li><strong>Gambar:</strong> www.canva.com</li>
                </ul>
            <div class="text-center">
                <button onclick="closeModal('sumber-modal')" class="btn-3d bg-teal-600 hover:bg-teal-700">Tutup</button>
            </div>
        </div>
    </div>


    <div id="material-modal" class="hidden fixed inset-0 modal flex items-center justify-center p-4">
        <div class="bg-gray-700/80 backdrop-blur-md rounded-lg shadow-xl max-w-5xl w-full flex flex-col max-h-[80vh]">
            <h3 class="text-3xl font-pixel text-orange-400 mb-6 text-center p-8 pb-4 flex-shrink-0">Materi Biotik Abiotik</h3>
            <div class="text-left space-y-4 p-8 pt-0 modal-scroll-content">
                <div>
                    <h4 class="text-xl font-bold text-white mb-2">Apa itu Ekosistem?</h4>
                    <p>Ekosistem adalah suatu sistem ekologi yang terbentuk oleh hubungan timbal balik tak terpisahkan antara makhluk hidup dengan lingkungannya. Ekosistem terdiri dari dua komponen utama.</p>
                </div>
                <div>
                    <h4 class="text-xl font-bold text-green-400 mb-2">1. Komponen Biotik</h4>
                    <p>Komponen biotik adalah semua makhluk hidup yang ada di dalam ekosistem. Contohnya:</p>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li><strong>Produsen:</strong> Makhluk hidup yang dapat membuat makanannya sendiri, seperti tumbuhan hijau (Pohon 🌳, Rumput 🌱).</li>
                        <li><strong>Konsumen:</strong> Makhluk hidup yang tidak dapat membuat makanannya sendiri dan bergantung pada produsen, seperti hewan (Ikan 🐟, Burung 🐦).</li>
                        <li><strong>Dekomposer (Pengurai):</strong> Organisme yang menguraikan sisa-sisa makhluk hidup yang telah mati, seperti jamur 🍄 dan bakteri.</li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-xl font-bold text-blue-400 mb-2">2. Komponen Abiotik</h4>
                    <p>Komponen abiotik adalah semua benda tak hidup yang menjadi bagian dari ekosistem dan memengaruhi kehidupan komponen biotik. Contohnya:</p>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li><strong>Air (💧):</strong> Penting untuk minum dan proses fotosintesis.</li>
                        <li><strong>Tanah (🟫) & Batu (🪨):</strong> Tempat hidup tumbuhan dan sumber mineral.</li>
                        <li><strong>Udara (💨):</strong> Sumber oksigen untuk bernapas dan karbon dioksida untuk fotosintesis.</li>
                        <li><strong>Cahaya Matahari (☀️) & Suhu (🌡️):</strong> Sumber energi utama dan pengatur suhu lingkungan.</li>
                    </ul>
                </div>
            </div>
            <div class="text-center p-6 mt-auto flex-shrink-0">
                <button onclick="closeModal('material-modal')" class="btn-3d bg-orange-600 hover:bg-orange-700">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Developer Modal -->
    <div id="developer-modal" class="hidden fixed inset-0 modal flex items-center justify-center p-4">
        <div class="modal-content bg-gray-800/80 backdrop-blur-md">
            <img src="https://lh3.googleusercontent.com/d/1ivUN8B8xdd4R8Kef_-wEqNx56_eeUv4w" alt="Background" class="modal-bg-image-profile">
            <div class="modal-main-content">
                <div class="profile-pic-container">
                    <img src="https://lh3.googleusercontent.com/d/1tFGMHXxFlkz5Ij0nHbxddt4aF-MfnTio" alt="Foto Profil">
                </div>
                <div class="profile-text" style="text-align: left; flex-grow: 1;">
                    <h2 style="margin: 0; font-size: 1.5em; border:none; padding:0; text-shadow: none; color: white;">BINTANG ADHI PERMANA</h2>
                    <p style="margin: 5px 0; font-size: 0.9em; color: #d1d5db;">SDN Lubang Buaya 01, Jakarta Timur</p>
                    <p style="margin: 10px 0 5px 0; font-weight: bold; font-size: 0.9em; color: #9ca3af;">Kontak:</p>
                    <div class="social-icons" style="font-size: 1.8em; display: flex; gap: 15px;">
                        <a href="https://www.facebook.com/bintang.a.permana.1/" target="_blank" style="color: blue; text-decoration: none;"><i class="fab fa-facebook"></i></a>
                        <a href="https://www.youtube.com/@Bangbin_1" target="_blank" style="color: red; text-decoration: none;"><i class="fab fa-youtube"></i></a>
                        <a href="https://wa.me/6281310051985" target="_blank" style="color: green; text-decoration: none;"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
            </div>
            <button onclick="closeModal('developer-modal')" class="btn-3d bg-indigo-600 hover:bg-indigo-700 mt-6 absolute bottom-4 right-4 text-sm px-4 py-2 z-10">Tutup</button>
        </div>
    </div>
	
    <!-- Reset Confirmation Modal -->
    <div id="reset-confirm-modal" class="hidden fixed inset-0 modal flex items-center justify-center">
        <div class="bg-gray-700/80 backdrop-blur-md p-8 rounded-lg text-center shadow-xl max-w-md w-full">
            <h3 class="text-2xl font-bold mb-6">Reset Progres?</h3>
            <p class="text-gray-300 mb-8">Apakah Anda yakin ingin menghapus semua progres level yang telah disimpan?</p>
            <div class="flex justify-center gap-4">
                <button onclick="confirmReset()" class="btn-3d bg-red-600 hover:bg-red-700">Ya, Reset</button>
                <button onclick="closeModal('reset-confirm-modal')" class="btn-3d bg-gray-500 hover:bg-gray-600">Batal</button>
            </div>
        </div>
    </div>


    <script>
        // --- DOM Elements ---
        const startScreen = document.getElementById('start-screen');
        const worldMapScreen = document.getElementById('world-map-screen');
        const gameScreen = document.getElementById('game-screen');
        const gameTitle = document.getElementById('game-title');
        const playerScoreDisplay = document.getElementById('player-score');
        const computerScoreDisplay = document.getElementById('computer-score');
        const gameContainer = document.getElementById('game-container');
        const resultModal = document.getElementById('result-modal');
        const resultMessage = document.getElementById('result-message');
        const unlockMessage = document.getElementById('unlock-message');
        const timerDisplay = document.getElementById('timer-display');
        const mapLocations = document.querySelectorAll('.map-location');
        const startAdventureBtn = document.getElementById('start-adventure-btn');
        const musicToggleBtn = document.getElementById('music-toggle-btn');


        // --- Game Data ---
        const games = [
            { name: "Hutan Ekologi", type: "matching" },
            { name: "Kuil Klasifikasi", type: "dragdrop" },
            { name: "Gunung Ekosistem", type: "quiz" },
            { name: "Lembah Komponen", type: "catcher" }
        ];

        // --- Game State ---
        let unlockedLevels = 1;
        let currentLevelIndex = 0;
        let playerScore = 0, computerScore = 0;
        let gameInProgress = false;
        let currentInterval, currentTimeout;
        
        // --- Sound Effects (Tone.js) ---
        let soundsReady = false;
        let backgroundMusic;
        const soundEffects = {};

        function initializeSounds() {
            if (soundsReady) return;
            
            // This function is called by a user gesture (startAdventureBtn click)
            Tone.start();

            // Sound for simple clicks
            soundEffects.click = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.005, decay: 0.1, sustain: 0, release: 0.1 } }).toDestination();
            
            // Sound for correct actions
            soundEffects.correct = new Tone.Synth({ oscillator: { type: 'triangle' }, envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.2 } }).toDestination();
            
            // Sound for wrong actions
            soundEffects.wrong = new Tone.Synth({ oscillator: { type: 'square' }, envelope: { attack: 0.01, decay: 0.4, sustain: 0, release: 0.1 } }).toDestination();
            
            // Sound for player winning
            soundEffects.winner = new Tone.Synth().toDestination();
            
            // Sound for computer winning
            soundEffects.computerWinner = new Tone.Synth({ oscillator: { type: "sawtooth" }, envelope: { attack: 0.2, decay: 0.5, release: 1, sustain: 0 } }).toDestination();

            // Background music loop
            backgroundMusic = new Tone.Loop(time => {
                const synth = new Tone.Synth().toDestination();
                synth.triggerAttackRelease("C3", "8n", time);
                synth.triggerAttackRelease("G3", "8n", time + Tone.Time("8n").toSeconds());
                synth.triggerAttackRelease("E3", "8n", time + Tone.Time("4n").toSeconds());
                synth.triggerAttackRelease("A3", "8n", time + Tone.Time("4n").toSeconds() + Tone.Time("8n").toSeconds());
            }, "1n").start(0);
            
            Tone.Transport.bpm.value = 90;
            soundsReady = true;
            console.log("Sound system initialized.");
        }

        function playSound(name, note, duration = '8n') {
            if (!soundsReady || !soundEffects[name]) return;
            try {
                soundEffects[name].triggerAttackRelease(note, duration);
            } catch (e) {
                console.error(`Error playing sound ${name}:`, e);
            }
        }

        function playMelody(name, notes) {
            if (!soundsReady || !soundEffects[name]) return;
            const now = Tone.now();
            notes.forEach(([note, duration, time]) => {
                soundEffects[name].triggerAttackRelease(note, duration, now + time);
            });
        }

        function toggleMusic(play) {
            if (!soundsReady) return;
            if (play && Tone.Transport.state !== 'started') {
                Tone.Transport.start();
            } else if (!play && Tone.Transport.state === 'started') {
                Tone.Transport.stop();
            }
        }


        // --- Modal Logic ---
        function openModal(modalId) {
            playSound('click', 'C5');
            document.getElementById(modalId).classList.remove('hidden');
        }
        function closeModal(modalId) {
            playSound('click', 'C5');
            document.getElementById(modalId).classList.add('hidden');
        }

        // --- Core Logic ---
        function loadProgress() {
            const savedProgress = localStorage.getItem('ecosystemAdventureProgress');
            unlockedLevels = savedProgress ? parseInt(savedProgress) : 1;
        }

        function saveProgress() {
            localStorage.setItem('ecosystemAdventureProgress', unlockedLevels);
        }
        
        function resetProgress() {
            playSound('click', 'A4');
            openModal('reset-confirm-modal');
        }

        function confirmReset() {
            playSound('wrong', 'E3', '4n');
            unlockedLevels = 1;
            saveProgress();
            updateMapView();
            closeModal('reset-confirm-modal');
        }

        function updateMapView() {
            mapLocations.forEach(loc => {
                const level = parseInt(loc.dataset.level);
                const button = loc.querySelector('button');
                const existingIcon = loc.querySelector('.lock-icon');
                if (existingIcon) existingIcon.remove();

                if (level < unlockedLevels) {
                    button.disabled = false;
                    button.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    button.disabled = true;
                    button.classList.add('opacity-50', 'cursor-not-allowed');
                    const lockIcon = document.createElement('div');
                    lockIcon.className = 'lock-icon';
                    lockIcon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lock-fill text-gray-900" viewBox="0 0 16 16"><path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2m3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2"/></svg>`;
                    loc.appendChild(lockIcon);
                }
            });
        }

        function showScreen(screenId) {
            startScreen.classList.add('hidden');
            worldMapScreen.classList.add('hidden');
            gameScreen.classList.add('hidden');
            
            const screenToShow = document.getElementById(screenId);
            screenToShow.classList.remove('hidden');
            if(screenId === 'game-screen' || screenId === 'world-map-screen' || screenId === 'start-screen') {
                 screenToShow.classList.add('flex');
            }
        }

        function startGame(gameIndex) {
            playSound('click', 'E5');
            toggleMusic(false);
            currentLevelIndex = gameIndex;
            const game = games[gameIndex];
            gameTitle.textContent = game.name;
            playerScore = 0;
            computerScore = 0;
            updateScores();
            showScreen('game-screen');
            gameInProgress = true;
            
            if (currentInterval) clearInterval(currentInterval);
            if (currentTimeout) clearTimeout(currentTimeout);

            switch(game.type) {
                case 'matching': setupMatchingGame(); break;
                case 'dragdrop': setupDragDropGame(); break;
                case 'quiz': setupQuizGame(); break;
                case 'catcher': setupCatcherGame(); break;
            }
        }
        
        function returnToMap() {
            playSound('click', 'A4');
            toggleMusic(true);
            gameInProgress = false;
            if (currentInterval) clearInterval(currentInterval);
            if (currentTimeout) clearTimeout(currentTimeout);
            showScreen('world-map-screen');
            updateMapView();
        }

        function updateScores() {
            playerScoreDisplay.textContent = playerScore;
            computerScoreDisplay.textContent = computerScore;
        }
        
        function showResult(message) {
            gameInProgress = false;
            resultMessage.textContent = message;
            unlockMessage.classList.add('hidden');

            if (playerScore > computerScore) {
                playMelody('winner', [['C4', '8n', 0], ['E4', '8n', 0.15], ['G4', '8n', 0.3], ['C5', '4n', 0.45]]);
                const nextLevel = currentLevelIndex + 1;
                if (nextLevel < games.length && nextLevel >= unlockedLevels) {
                    unlockedLevels = nextLevel + 1;
                    saveProgress();
                    unlockMessage.classList.remove('hidden');
                }
            } else {
                 playMelody('computerWinner', [['G3', '4n', 0], ['F#3', '4n', 0.3], ['F3', '4n', 0.6], ['E3', '2n', 0.9]]);
            }
            
            openModal('result-modal');
            if (currentInterval) clearInterval(currentInterval);
            if (currentTimeout) clearTimeout(currentTimeout);
        }

        function closeModalAndReturn() {
            closeModal('result-modal');
            returnToMap();
        }
        
        // --- Event Listeners and Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Vanta.js Background
            VANTA.WAVES({
              el: "#vanta-bg",
              mouseControls: true,
              touchControls: true,
              gyroControls: false,
              minHeight: 200.00,
              minWidth: 200.00,
              scale: 1.00,
              scaleMobile: 1.00,
              color: 0x0044ff,
              shininess: 50.00,
              waveHeight: 20.00,
              waveSpeed: 0.75,
              zoom: 0.8
            });

            loadProgress();
            updateMapView();

            startAdventureBtn.addEventListener('click', () => {
                initializeSounds();
                toggleMusic(true);
                musicToggleBtn.innerHTML = '<i class="fas fa-music"></i>';
                showScreen('world-map-screen');
            });

            musicToggleBtn.addEventListener('click', () => {
                playSound('click', 'C5');
                const isPlaying = Tone.Transport.state === 'started';
                toggleMusic(!isPlaying);
                musicToggleBtn.innerHTML = isPlaying ? '<i class="fas fa-skull"></i>' : '<i class="fas fa-music"></i>';
            });

            // --- 3D Profile Picture Logic ---
            const developerModal = document.getElementById('developer-modal');
            if (developerModal) {
                const profilePicContainer = developerModal.querySelector('.profile-pic-container');
                if (profilePicContainer) {
                    const profilePic = profilePicContainer.querySelector('img');
                    const maxRotate = 20;

                    profilePicContainer.addEventListener('mousemove', (e) => {
                        const rect = profilePicContainer.getBoundingClientRect();
                        const mouseX = e.clientX - rect.left;
                        const mouseY = e.clientY - rect.top;
                        const rotateY = ((mouseX / rect.width) - 0.5) * 2 * maxRotate;
                        const rotateX = (((mouseY / rect.height) - 0.5) * 2 * maxRotate) * -1;
                        profilePic.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.1)`;
                    });

                    profilePicContainer.addEventListener('mouseleave', () => {
                        profilePic.style.transform = 'rotateX(0deg) rotateY(0deg) scale(1)';
                    });
                }
            }
        });

        // --- GAME 1: Matching Game (Biotik & Abiotik) ---
        let flippedCards = [], matchedPairs = 0, totalPairs = 0, currentPlayer = 'player';
        function setupMatchingGame() {
            const pairs = [
                {bio: 'Ikan 🐟', abio: 'Air 💧'}, {bio: 'Pohon 🌳', abio: 'Tanah 🟫'},
                {bio: 'Burung 🐦', abio: 'Udara 💨'}, {bio: 'Cacing 🐛', abio: 'Batu 🪨'},
                {bio: 'Rumput 🌱', abio: 'Suhu 🌡️'}, {bio: 'Jamur 🍄', abio: 'Cahaya ☀️'}
            ];
            const cardValues = pairs.flatMap(p => [p.bio, p.abio]).sort(() => 0.5 - Math.random());
            totalPairs = pairs.length;
            matchedPairs = 0;
            playerScore = 0; computerScore = 0;
            updateScores();
            currentPlayer = 'player';
            timerDisplay.innerHTML = `<p class="text-lg font-bold text-white">Giliran: <span id="turn-indicator" class="text-cyan-400">ANDA</span></p>`;
            gameContainer.innerHTML = `<div id="matching-grid" class="grid grid-cols-4 gap-4 w-full max-w-lg mx-auto"></div>`;
            const grid = document.getElementById('matching-grid');
            cardValues.forEach(value => {
                const card = document.createElement('div');
                card.className = 'card h-20 md:h-24 cursor-pointer';
                const pair = pairs.find(p => p.bio === value || p.abio === value);
                card.dataset.pairId = pairs.indexOf(pair);
                card.innerHTML = `<div class="card-inner"><div class="card-front">?</div><div class="card-back">${value}</div></div>`;
                card.addEventListener('click', () => handleCardClick(card));
                grid.appendChild(card);
            });
        }
        function handleCardClick(card) {
            if (!gameInProgress || card.classList.contains('flipped') || flippedCards.length === 2 || currentPlayer !== 'player') return;
            playSound('click', 'C5');
            card.classList.add('flipped');
            flippedCards.push(card);
            if (flippedCards.length === 2) checkMatch();
        }
        function checkMatch() {
            const [card1, card2] = flippedCards;
            if (card1.dataset.pairId === card2.dataset.pairId) {
                playSound('correct', 'G5');
                playerScore++; matchedPairs++; updateScores(); flippedCards = [];
                if (checkGameOver()) return;
                switchTurn();
            } else {
                playSound('wrong', 'C3', '4n');
                setTimeout(() => {
                    card1.classList.remove('flipped'); card2.classList.remove('flipped');
                    flippedCards = []; switchTurn();
                }, 1200);
            }
        }
        function switchTurn() {
            if (!gameInProgress) return;
            currentPlayer = (currentPlayer === 'player') ? 'computer' : 'player';
            const indicator = document.getElementById('turn-indicator');
            if(indicator) {
                indicator.textContent = currentPlayer === 'player' ? 'ANDA' : 'KOMPUTER';
                indicator.className = currentPlayer === 'player' ? 'text-cyan-400' : 'text-red-400';
            }
            if (currentPlayer === 'computer') setTimeout(computerTurn, 1500);
        }
        function computerTurn() {
            if (!gameInProgress) return;
            let unflippedCards = Array.from(document.querySelectorAll('.card:not(.flipped)'));
            if (unflippedCards.length < 2) return;
            let choice1Index = Math.floor(Math.random() * unflippedCards.length);
            let card1 = unflippedCards[choice1Index];
            unflippedCards.splice(choice1Index, 1);
            let choice2Index = Math.floor(Math.random() * unflippedCards.length);
            let card2 = unflippedCards[choice2Index];
            card1.classList.add('flipped'); card2.classList.add('flipped');
            setTimeout(() => {
                 if (card1.dataset.pairId === card2.dataset.pairId) {
                    playSound('correct', 'E5');
                    computerScore++; matchedPairs++; updateScores();
                    if (checkGameOver()) return;
                } else {
                    card1.classList.remove('flipped'); card2.classList.remove('flipped');
                }
                switchTurn();
            }, 1500);
        }
        function checkGameOver() {
            if (matchedPairs === totalPairs) {
                let message = playerScore > computerScore ? "Kamu Menang!" : (computerScore > playerScore ? "Komputer Menang!" : "Seri!");
                setTimeout(() => showResult(message), 500);
                return true;
            }
            return false;
        }

        // --- GAME 2: Drag and Drop (Klasifikasi) ---
        let correctDrops = 0, totalDraggables = 0;
        let touchDraggedItem = null;
        let originalParent = null;

        function touchStartHandler(e) {
            const target = e.target.closest('.draggable');
            if (!target || !gameInProgress) return;
            playSound('click', 'C5');
            touchDraggedItem = target;
            originalParent = target.parentNode;
            const touch = e.targetTouches[0];
            const rect = target.getBoundingClientRect();
            const offsetX = touch.clientX - rect.left;
            const offsetY = touch.clientY - rect.top;
            target.style.position = 'fixed';
            target.style.zIndex = '1000';
            target.style.cursor = 'grabbing';
            target.style.left = `${touch.clientX - offsetX}px`;
            target.style.top = `${touch.clientY - offsetY}px`;
            document.addEventListener('touchmove', touchMoveHandler, { passive: false });
            document.addEventListener('touchend', touchEndHandler);
        }

        function touchMoveHandler(e) {
            if (!touchDraggedItem) return;
            e.preventDefault(); 
            const touch = e.targetTouches[0];
            const offsetX = touchDraggedItem.offsetWidth / 2;
            const offsetY = touchDraggedItem.offsetHeight / 2;
            touchDraggedItem.style.left = `${touch.clientX - offsetX}px`;
            touchDraggedItem.style.top = `${touch.clientY - offsetY}px`;
        }

        function touchEndHandler(e) {
            if (!touchDraggedItem) return;
            touchDraggedItem.style.visibility = 'hidden';
            const dropTarget = document.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
            touchDraggedItem.style.visibility = 'visible';
            const dropzone = dropTarget ? dropTarget.closest('.dropzone') : null;
            if (dropzone && touchDraggedItem.dataset.type === dropzone.dataset.target) {
                handleCorrectDrop(touchDraggedItem, dropzone);
            } else {
                playSound('wrong', 'D3', '4n');
                originalParent.appendChild(touchDraggedItem);
            }
            touchDraggedItem.style.position = 'static';
            touchDraggedItem.style.zIndex = 'auto';
            touchDraggedItem.style.cursor = 'grab';
            touchDraggedItem = null;
            originalParent = null;
            document.removeEventListener('touchmove', touchMoveHandler);
            document.removeEventListener('touchend', touchEndHandler);
        }

        function handleCorrectDrop(draggableElement, dropzone) {
            if (draggableElement.parentNode === dropzone) return;
            playSound('correct', 'A5');
            dropzone.appendChild(draggableElement);
            draggableElement.style.position = 'static';
            draggableElement.style.zIndex = 'auto';
            draggableElement.classList.remove('draggable');
            draggableElement.setAttribute('draggable', 'false');
            draggableElement.removeEventListener('touchstart', touchStartHandler);
            correctDrops++;
            if (correctDrops === totalDraggables) {
                playerScore = 1;
                computerScore = 0;
                const finalTime = document.getElementById('dd-timer').textContent;
                showResult(`Kamu selesai dalam ${finalTime}! Kamu Menang!`);
            }
        }

        function setupDragDropGame() {
            const items = [
                { content: '🐟', type: 'biotik' }, { content: '🪨', type: 'abiotik' },
                { content: '🌳', type: 'biotik' }, { content: '💧', type: 'abiotik' },
                { content: '🐦', type: 'biotik' }, { content: '💨', type: 'abiotik' }
            ];
            totalDraggables = items.length; correctDrops = 0; playerScore = 0; computerScore = 0;
            updateScores();
            timerDisplay.innerHTML = `<p id="dd-timer" class="text-2xl font-bold text-white">0.0s</p>`;
            gameContainer.innerHTML = `
                <div class="flex flex-col gap-4 w-full h-full items-center justify-between">
                    <div id="drop-target" class="flex flex-col sm:flex-row gap-4 w-full justify-center">
					  <div data-target="biotik" class="dropzone w-full sm:w-96 h-64 border-4 border-dashed border-cyan-500 rounded-lg flex items-center justify-center relative p-2 flex-wrap gap-2">
						<span style="position: absolute;font-size: 3rem;font-weight: bold;color: rgba(0, 255, 255, 0.2);pointer-events: none;user-select: none;">BIOTIK</span></div>
					  <div data-target="abiotik" class="dropzone w-full sm:w-96 h-64 border-4 border-dashed border-red-500 rounded-lg flex items-center justify-center relative p-2 flex-wrap gap-2">
						<span style="position: absolute;font-size: 3rem;font-weight: bold;color: rgba(255, 0, 0, 0.2);pointer-events: none;user-select: none;">ABIOTIK</span></div>
                    </div>
                    <div id="drag-source" class="flex flex-wrap justify-center content-start gap-4 p-4 bg-gray-700/70 backdrop-blur-sm rounded-lg w-full flex-grow min-h-[150px]">
                        ${items.sort(() => 0.5 - Math.random()).map((item, index) => `
                            <div id="drag-${index}" draggable="true" data-type="${item.type}" class="draggable text-8xl p-3 rounded-lg">${item.content}</div>
                        `).join('')}
                    </div>
                </div>`;
            
            document.querySelectorAll('.draggable').forEach(elem => {
                elem.addEventListener('dragstart', e => {
                    playSound('click', 'C5');
                    e.dataTransfer.setData('text/plain', e.target.id);
                });
                elem.addEventListener('touchstart', touchStartHandler);
            });

            document.querySelectorAll('.dropzone').forEach(elem => {
                elem.addEventListener('dragover', e => e.preventDefault());
                elem.addEventListener('drop', drop);
            });

            let startTime = Date.now();
            currentInterval = setInterval(() => {
                if(gameInProgress && document.getElementById('dd-timer')) {
                    document.getElementById('dd-timer').textContent = `${((Date.now() - startTime) / 1000).toFixed(1)}s`;
                }
            }, 100);
            
            const computerTime = (Math.random() * 8 + 8) * 1000;
            currentTimeout = setTimeout(() => {
                if (gameInProgress) {
                    playerScore = 0;
                    computerScore = 1;
                    showResult(`Komputer selesai dalam ${ (computerTime/1000).toFixed(1)}s! Kamu Kalah!`);
                }
            }, computerTime);
        }
        function drop(e) {
            e.preventDefault();
            if (!gameInProgress) return;
            const id = e.dataTransfer.getData('text/plain');
            const draggableElement = document.getElementById(id);
            const dropzone = e.target.closest('.dropzone');
            if (draggableElement && dropzone && draggableElement.dataset.type === dropzone.dataset.target) {
                handleCorrectDrop(draggableElement, dropzone);
            } else {
                playSound('wrong', 'D3', '4n');
            }
        }

        // --- GAME 3: Quiz Game (Ekosistem) ---
        const quizQuestions = [
            { q: "Manakah di berikut ini yang termasuk komponen abiotik?", a: ["�", "🌳", "💧", "🦋"], c: "💧" },
            { q: "Semua makhluk hidup dalam ekosistem disebut komponen...", a: ["Biotik", "Abiotik", "Geotik", "Hidrotik"], c: "Biotik" },
            { q: "Cahaya matahari, suhu, dan kelembapan adalah contoh dari...", a: ["Komponen Produsen", "Komponen Konsumen", "Komponen Biotik", "Komponen Abiotik"], c: "Komponen Abiotik" },
            { q: "Berikut ini yang BUKAN merupakan komponen biotik adalah...", a: ["🤹", "💦", "🦁", "🐟"], c: "💦" },
            { q: "Interaksi antara komponen biotik dan abiotik membentuk suatu...", a: ["Populasi", "Komunitas", "Ekosistem", "Biosfer"], c: "Ekosistem" }
        ];
        let quizQuestionIndex = 0; const totalQuestions = 3;
        function setupQuizGame() {
            quizQuestions.sort(() => 0.5 - Math.random());
            quizQuestionIndex = 0; playerScore = 0; computerScore = 0; updateScores();
            timerDisplay.innerHTML = `<p class="text-lg font-bold text-white">Pertanyaan <span id="q-count">1</span> / ${totalQuestions}</p>`;
            loadQuizQuestion();
        }
        function loadQuizQuestion() {
            if (quizQuestionIndex >= totalQuestions) { endQuiz(); return; }
            document.getElementById('q-count').textContent = quizQuestionIndex + 1;
            const question = quizQuestions[quizQuestionIndex];
            gameContainer.innerHTML = `
                <div class="text-center w-full">
                    <p class="text-xl md:text-2xl mb-8">${question.q}</p>
                    <div id="answer-options" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-lg mx-auto">
                        ${question.a.map(opt => `<button class="btn-3d bg-purple-600 hover:bg-purple-700 p-4">${opt}</button>`).join('')}
                    </div>
                </div>`;
            const answerButtons = document.querySelectorAll('#answer-options button');
            answerButtons.forEach(button => button.addEventListener('click', () => checkAnswer(button.textContent, answerButtons)));
            currentTimeout = setTimeout(() => {
                if (gameInProgress) {
                    playSound('wrong', 'C3', '2n');
                    computerScore++; updateScores();
                    highlightAnswers(answerButtons, question.c, null);
                    quizQuestionIndex++; setTimeout(loadQuizQuestion, 2000);
                }
            }, Math.random() * 4000 + 2000);
        }
        function checkAnswer(selectedAnswer, buttons) {
            if (!gameInProgress) return;
            clearTimeout(currentTimeout); gameInProgress = false;
            const correct = quizQuestions[quizQuestionIndex].c;
            if (selectedAnswer === correct) {
                playSound('correct', 'C6');
                playerScore++;
            } else {
                playSound('wrong', 'E3', '4n');
            }
            updateScores(); highlightAnswers(buttons, correct, selectedAnswer);
            quizQuestionIndex++; setTimeout(() => { gameInProgress = true; loadQuizQuestion(); }, 2000);
        }
        function highlightAnswers(buttons, correctAnswer, playerSelection) {
            buttons.forEach(button => {
                button.disabled = true;
                button.classList.remove('bg-purple-600', 'hover:bg-purple-700');
                if (button.textContent === correctAnswer) button.classList.add('bg-green-500');
                else if (button.textContent === playerSelection) button.classList.add('bg-red-500');
                else button.classList.add('bg-gray-500');
            });
        }
        function endQuiz() {
            let message = playerScore > computerScore ? "Kamu Menang!" : (computerScore > playerScore ? "Komputer Menang!" : "Seri!");
            showResult(message);
        }

        // --- GAME 4: Catcher Game (Komponen) ---
        let canvas, ctx, playerBasket, computerBasket, items, gameLoopId, clue;
        const gameDuration = 30000;
        const allItems = [
            { emoji: '🐘', type: 'biotik' }, { emoji: '🐒', type: 'biotik' }, { emoji: '🌷', type: 'biotik' },
            { emoji: '🪨', type: 'abiotik' }, { emoji: '💧', type: 'abiotik' }, { emoji: '☀️', type: 'abiotik' },
			{ emoji: '🦁', type: 'biotik' }, { emoji: '🦋', type: 'biotik' }, { emoji: '🌡️', type: 'abiotik' }
        ];

        function setupCatcherGame() {
            clue = Math.random() < 0.5 ? 'biotik' : 'abiotik';
            gameContainer.innerHTML = `
                <div class="relative w-full max-w-8xl aspect-[7/3] bg-transparent rounded-lg">
                    <div class="absolute top-2 left-1/2 -translate-x-1/2 bg-black bg-opacity-50 px-4 py-2 rounded-lg text-yellow-300 font-bold text-lg z-10">
                        Tangkap semua komponen ${clue.toUpperCase()}!
                    </div>
                    <canvas id="game-canvas" class="w-full h-full rounded-lg"></canvas>
                </div>`;
            canvas = document.getElementById('game-canvas'); 
            ctx = canvas.getContext('2d');
            
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width; 
            canvas.height = rect.height;

            playerScore = 0; computerScore = 0; updateScores(); items = [];
            playerBasket = { x: canvas.width / 4, y: canvas.height - 30, width: 80, height: 20, color: '#3b82f6' };
            computerBasket = { x: (canvas.width / 4) * 3, y: canvas.height - 30, width: 80, height: 20, color: '#ef4444' };
            
            canvas.addEventListener('mousemove', movePlayerBasket);
            canvas.addEventListener('touchmove', movePlayerBasketTouch, { passive: false });
            
            gameInProgress = true;
            let timeLeft = gameDuration / 1000;
            timerDisplay.innerHTML = `<p id="catcher-timer" class="text-4xl font-bold text-white">${timeLeft}</p>`;
            
            currentInterval = setInterval(() => {
                timeLeft--;
                if(document.getElementById('catcher-timer')) document.getElementById('catcher-timer').textContent = timeLeft;
                if (timeLeft <= 0) endCatcherGame();
            }, 1000);
            
            gameLoopId = requestAnimationFrame(gameLoop);
            currentTimeout = setInterval(createItem, 800);
        }
        function endCatcherGame() {
             if (!gameInProgress) return;
             gameInProgress = false; cancelAnimationFrame(gameLoopId); clearInterval(currentInterval); clearInterval(currentTimeout);
             let message = playerScore > computerScore ? "Kamu Menang!" : (computerScore > playerScore ? "Komputer Menang!" : "Seri!");
             showResult(message);
        }
        function movePlayerBasket(e) {
            const rect = canvas.getBoundingClientRect();
            playerBasket.x = e.clientX - rect.left - playerBasket.width / 2;
        }
        function movePlayerBasketTouch(e) {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            playerBasket.x = e.touches[0].clientX - rect.left - playerBasket.width / 2;
        }
        function createItem() {
            if (!gameInProgress) return;
            const itemProto = allItems[Math.floor(Math.random() * allItems.length)];
            items.push({ ...itemProto, x: Math.random() * canvas.width, y: -20, radius: 15, speed: Math.random() * 3 + 2 });
        }
        function gameLoop() {
            if (!gameInProgress) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            items.forEach((item, index) => {
                item.y += item.speed; ctx.font = '60px serif';
                ctx.fillText(item.emoji, item.x - item.radius, item.y + item.radius);
                if (item.y + item.radius > playerBasket.y && item.x > playerBasket.x && item.x < playerBasket.x + playerBasket.width) {
                    if (item.type === clue) { playSound('correct', 'A5', '16n'); playerScore++; } else { playSound('wrong', 'F3', '8n'); playerScore--; }
                    updateScores(); items.splice(index, 1);
                } else if (item.y + item.radius > computerBasket.y && item.x > computerBasket.x && item.x < computerBasket.x + computerBasket.width) {
                    if (item.type === clue) { playSound('correct', 'G4', '16n'); computerScore++; } else { playSound('wrong', 'G2', '8n'); computerScore--; }
                    updateScores(); items.splice(index, 1);
                } else if (item.y > canvas.height) items.splice(index, 1);
            });
            let targetItem = null, minDistance = Infinity;
            items.forEach(item => {
                if(item.type === clue) {
                    const distance = Math.hypot(item.x - (computerBasket.x + computerBasket.width / 2), item.y - computerBasket.y);
                    if(distance < minDistance) { minDistance = distance; targetItem = item; }
                }
            });
            if (targetItem) {
                if (targetItem.x > computerBasket.x + computerBasket.width / 2) computerBasket.x += 4;
                else computerBasket.x -= 4;
            }
            playerBasket.x = Math.max(0, Math.min(canvas.width - playerBasket.width, playerBasket.x));
            computerBasket.x = Math.max(0, Math.min(canvas.width - computerBasket.width, computerBasket.x));
            ctx.fillStyle = playerBasket.color; ctx.fillRect(playerBasket.x, playerBasket.y, playerBasket.width, playerBasket.height);
            ctx.fillStyle = computerBasket.color; ctx.fillRect(computerBasket.x, computerBasket.y, computerBasket.width, computerBasket.height);
            gameLoopId = requestAnimationFrame(gameLoop);
        }
    </script>
</body>
</html>